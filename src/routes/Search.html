<main role="main">

	<section class="jumbotron text-center">
		<div class="container">
			<h1 class="jumbotron-heading">{#if chunks && chunks.length === 0}No {/if}Search Results</h1>
		</div>
	</section>

	{#if chunks} {#each chunks as chunk}
	<div class="album py-5 bg-light">
		<div class="container">
			<div class="row">
				{#each chunk as result}
				<div class="col-lg-4">
					<div class="card mb-4 shadow-sm">
						<a class="bd-placeholder card-img-top mt-4" href={`finances?id=${result.candidate.id}`}>
							<img class="bd-placeholder-image card-img-top" alt="" src={`https://theunitedstates.io/images/congress/225x275/${result.candidate.id}.jpg`}
							/>
						</a>
						<div class="card-body">
							<p class="card-text">{result.candidate.name}</p>
							<div class="d-flex justify-content-between align-items-center">
								<div class="btn-group">
									<a href={`finances?id=${result.candidate.id}`} class="btn btn-sm btn-outline-secondary">View Info</a>
								</div>
								<small class="text-muted">{result.candidate.party}</small>
							</div>
						</div>
					</div>
				</div>
				{/each}
			</div>
		</div>
	</div>
	{/each}{:else}
	<div class="text-center">
		<Loader />
		<LoadingMessage message={true} />
	</div>
	{/if}

</main>

<script>
		import client from "../client";
		import { getCycle, getUrlVars } from "../tools";

		export default {
		  components: {
				Loader: "../components/Loader.html",
				LoadingMessage: "../components/LoadingMessage.html"
		  },
		  async oncreate() {
		    const { cycle, query } = getUrlVars();

				// TODO: Move this to State/District search at: https://projects.propublica.org/api-docs/congress-api/members/#get-current-members-by-statedistrict
		    const response = await client(
		      `https://api.propublica.org/campaign-finance/v1/${getCycle(
		        cycle
		      )}/candidates/search.json?query=${query}`
		    );

		    const chunkSize = 3;
		    const chunks = [];
		    for (let i = 0, j = response.results.length; i < j; i += chunkSize) {
		      chunks.push(response.results.slice(i, i + chunkSize));
		    }

		    this.set({ chunks });
		  },
		  data() {
		    return {
		      chunks: null
		    };
		  }
		};
</script>

<style>
	.bd-placeholder, .bd-placeholder-image {
	  position: relative;
	  height: 225px;
	  width: 275px;
	  margin: 0 auto;
	}

	.bd-placeholder-image:before {
	  content: " ";
	  display: block;
	  position: absolute;
	  left: 0;
	  height: 225px;
	  width: 275px;
	  background-color: white;
	  background-image: url("https://www.bsn.eu/wp-content/uploads/2016/12/user-icon-image-placeholder-300-grey.jpg");
	  background-position: center;
	  background-repeat: no-repeat;
	  background-size: contain;
	}
</style>